---
layout: post
title: "[2018_sctf] CowBow 풀이"
date: 2018-07-04 04:44
categories: "[Pwn]CTF"
tags: rotles98
---

>## CowBoy (109pts)
### I mad a new heap allocator.
### Would you test this one?
### `nc cowboy.eatpwnnosleep.com 14697`
### [CowBoy](), [CowBoy_libc]()

- - -
# 0x00. 분석

{: refdef: style="text-align: center;"}
![file](/img/2018_sctf/CowBoy/01.png)
{: refdef}

`Partial RELRO`네요.

{: refdef: style="text-align: center;"}
![main](/img/2018_sctf/CowBoy/02.png)
{: refdef}

중요해 보이는 `func_alloc`랑 `func_fill`부터 볼게요.

{: refdef: style="text-align: center;"}
![func_alloc](/img/2018_sctf/CowBoy/03.png)
{: refdef}

`func_malloc`은 복잡한데 개입할 수 있는건 없어서 넘어가요.

{: refdef: style="text-align: center;"}
![func_fill](/img/2018_sctf/CowBoy/04.png)
{: refdef}

특이하게 `read`를 할 때 새로운 청크에다 받고 그걸 복사하네요.

근데 청크 사이즈가 같아서 `func_fill`을 하고나서 같거나 작은 크기로 `func_alloc`을 하면 `UAF`가 발생할 거 같네요.

- - -
# 0x01. 취약점 증명

>root@ubuntu:~/Pwn/2018_sctf/CowBoy# ./CowBoy<br />----------------------------------------<br />[\*] Testing dinggul's allocator...<br /><br />1. alloc<br />2. free<br />3. show heap chunks<br />4. fill data<br />5. exit<br />----------------------------------------<br />1<br />Let's ding_malloc!<br />Give me size n < 2049: 1<br />ding_malloc(1) = 0x72259780000<br />----------------------------------------<br />[\*] Testing dinggul's allocator...<br /><br />1. alloc<br />2. free<br />3. show heap chunks<br />4. fill data<br />5. exit<br />----------------------------------------<br />4<br />bin num? : 0<br />chunk num? : 0<br />111111112222222<br />input: ----------------------------------------<br />[\*] Testing dinggul's allocator...<br /><br />1. alloc<br />2. free<br />3. show heap chunks<br />4. fill data<br />5. exit<br />----------------------------------------<br />1<br />Let's ding_malloc!<br />Give me size n < 2049: 2<br />ding_malloc(2) = 0x72259780010<br />----------------------------------------<br />[\*] Testing dinggul's allocator...<br />1. alloc<br />2. free<br />3. show heap chunks<br />4. fill data<br />5. exit<br />----------------------------------------<br />3<br />Segmentation fault (core dumped)<br />

`111111112222222`는 `\n`까지 게산해서 15개만 넣었어요.
